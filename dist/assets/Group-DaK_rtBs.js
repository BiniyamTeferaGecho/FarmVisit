import{u as O,r as c,j as e,P as I,ak as $,T as B,M as q,C as J}from"./index-gIg6QK8U.js";const C=["SYSTEM","PROJECT","FUNCTIONAL","ORGANIZATIONAL","SECURITY"];function j(i){return i&&(i.UserID||i.userId||i.UserId||i.id||i.ID)}function Z(){const{user:i,fetchWithAuth:d}=O(),[f,w]=c.useState([]),[k,b]=c.useState(!1),[p,n]=c.useState(null),[x,S]=c.useState({totalCount:0,currentPage:1,pageSize:25}),[v,A]=c.useState([]),[G,R]=c.useState([]),[a,m]=c.useState({GroupName:"",GroupNameAmharic:"",GroupDescription:"",GroupType:"SECURITY",ParentGroupID:null,IsSystemGroup:!1,CanHaveMembers:!0,DefaultRoleID:null,IsActive:!0}),[P,y]=c.useState(!1),[r,l]=c.useState({open:!1,id:null,form:null,saving:!1}),[h,g]=c.useState({open:!1,id:null,title:"",message:"",processing:!1}),N=async(t=1)=>{b(!0);try{const s=await d({url:"/groups",method:"get",params:{page:t,pageSize:x.pageSize,SearchTerm:void 0}}),o=s.data&&s.data.data?s.data.data:s.data||{items:[]};w(o.items||[]),S(o.pagination||{totalCount:o.items.length||0,currentPage:t,pageSize:x.pageSize})}catch(s){console.error("fetchGroups error",s),n({type:"error",text:s?.response?.data?.message||s.message||"Failed to load groups"})}finally{b(!1)}},T=async()=>{try{const t=await d({url:"/groups",method:"get",params:{page:1,pageSize:1e3}}),s=t.data&&t.data.data?t.data.data:t.data||{items:[]};A(s.items||[])}catch(t){console.warn("fetchParents",t)}},M=async()=>{try{const t=await d({url:"/roles",method:"get",params:{page:1,pageSize:1e3}}),s=t.data&&t.data.data?t.data.data:t.data||{items:[]};R(s.items||[])}catch(t){console.warn("fetchRoles",t)}};c.useEffect(()=>{N(x.currentPage),T(),M()},[]);const D=()=>m({GroupName:"",GroupNameAmharic:"",GroupDescription:"",GroupType:"SECURITY",ParentGroupID:null,IsSystemGroup:!1,CanHaveMembers:!0,DefaultRoleID:null,IsActive:!0}),E=async t=>{if(t.preventDefault(),n(null),!a.GroupName){n({type:"error",text:"Group name is required"});return}const s=j(i);if(!s){n({type:"error",text:"You must be signed in to create groups."});return}y(!0);try{const o={GroupName:a.GroupName.trim(),GroupNameAmharic:a.GroupNameAmharic||null,GroupDescription:a.GroupDescription||null,GroupType:a.GroupType||null,ParentGroupID:a.ParentGroupID||null,IsSystemGroup:a.IsSystemGroup?1:0,CanHaveMembers:a.CanHaveMembers?1:0,DefaultRoleID:a.DefaultRoleID||null,IsActive:a.IsActive?1:0,CreatedBy:s};await d({url:"/groups",method:"post",data:o}),n({type:"success",text:"Group created"}),D(),await N(1)}catch(o){console.error("createGroup error",o),n({type:"error",text:o?.response?.data?.message||o.message||"Failed to create group"})}finally{y(!1)}},H=t=>l({open:!0,id:t.GroupID,form:{GroupName:t.GroupName,GroupNameAmharic:t.GroupNameAmharic||"",GroupDescription:t.GroupDescription||"",GroupType:t.GroupType||"SECURITY",ParentGroupID:t.ParentGroupID||null,IsSystemGroup:!!t.IsSystemGroup,CanHaveMembers:!!t.CanHaveMembers,DefaultRoleID:t.DefaultRoleID||null,IsActive:!!t.IsActive},saving:!1}),Y=async()=>{const{id:t,form:s}=r;if(!s.GroupName){n({type:"error",text:"Group name is required"});return}const o=j(i);if(!o){n({type:"error",text:"You must be signed in to update groups."});return}l(u=>({...u,saving:!0}));try{const u={GroupName:s.GroupName.trim(),GroupNameAmharic:s.GroupNameAmharic||null,GroupDescription:s.GroupDescription||null,GroupType:s.GroupType||null,ParentGroupID:s.ParentGroupID||null,CanHaveMembers:typeof s.CanHaveMembers>"u"?null:s.CanHaveMembers?1:0,DefaultRoleID:s.DefaultRoleID||null,IsActive:s.IsActive?1:0,UpdatedBy:o};await d({url:`/groups/${t}`,method:"patch",data:u}),n({type:"success",text:"Group updated"}),l({open:!1,id:null,form:null,saving:!1}),await N(x.currentPage)}catch(u){console.error("updateGroup error",u),n({type:"error",text:u?.response?.data?.message||u.message||"Failed to update group"}),l(F=>({...F,saving:!1}))}},U=t=>g({open:!0,id:t.GroupID,title:`Delete ${t.GroupName}`,message:"Soft-delete this group?",processing:!1}),L=async()=>{if(h.open){g(t=>({...t,processing:!0}));try{const t=j(i);if(!t)throw new Error("You must be signed in to delete groups.");await d({url:`/groups/${h.id}/delete`,method:"post",data:{DeletedBy:t}}),n({type:"success",text:"Group deleted"}),await N(x.currentPage)}catch(t){console.error("deleteGroup error",t),n({type:"error",text:t?.response?.data?.message||t.message||"Failed to delete group"})}finally{g({open:!1,id:null,title:"",message:"",processing:!1})}}},z=async(t,s=null)=>{if(!t)return!1;try{return(await d({url:"/groups/check-name",method:"get",params:{GroupName:t,ExcludeGroupID:s}}))?.data?.data?.exists||!1}catch{return!1}};return e.jsxs("div",{className:"space-y-6 h-full",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Groups"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create and manage application groups and hierarchies."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>l({open:!0,id:null,form:{...a},saving:!1}),className:"inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-md text-sm",children:[" ",e.jsx(I,{className:"h-4 w-4"})," New"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white p-6 rounded-lg shadow-sm text-left",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"New Group"}),e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Group Name"}),e.jsx("input",{value:a.GroupName,onChange:t=>m({...a,GroupName:t.target.value}),onBlur:async t=>{await z(t.target.value||"")&&n({type:"error",text:"Group name already exists"})},className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Name (Amharic)"}),e.jsx("input",{value:a.GroupNameAmharic,onChange:t=>m({...a,GroupNameAmharic:t.target.value}),className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Description"}),e.jsx("textarea",{value:a.GroupDescription,onChange:t=>m({...a,GroupDescription:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Type"}),e.jsx("select",{value:a.GroupType,onChange:t=>m({...a,GroupType:t.target.value}),className:"w-full px-3 py-2 border rounded",children:C.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Parent Group"}),e.jsxs("select",{value:a.ParentGroupID||"",onChange:t=>m({...a,ParentGroupID:t.target.value||null}),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"-- None --"}),v.map(t=>e.jsx("option",{value:t.GroupID,children:t.GroupName},t.GroupID))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Default Role"}),e.jsxs("select",{value:a.DefaultRoleID||"",onChange:t=>m({...a,DefaultRoleID:t.target.value||null}),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"-- None --"}),G.map(t=>e.jsx("option",{value:t.RoleID,children:t.RoleName},t.RoleID))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.IsSystemGroup,onChange:t=>m({...a,IsSystemGroup:t.target.checked}),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"System Group"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.CanHaveMembers,onChange:t=>m({...a,CanHaveMembers:t.target.checked}),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Can Have Members"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.IsActive,onChange:t=>m({...a,IsActive:t.target.checked}),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"submit",disabled:P,className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md",children:[" ",e.jsx(I,{className:"h-4 w-4"})," Create"]}),e.jsx("button",{type:"button",onClick:D,className:"px-3 py-2 border rounded-md",children:"Reset"})]}),p&&e.jsx("div",{className:`text-sm ${p.type==="error"?"text-red-600":"text-green-600"}`,children:p.text})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow-sm overflow-auto text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"All Groups"}),e.jsx("div",{className:"text-sm text-slate-500",children:k?"Loading...":`${x.totalCount||f.length||0} groups`})]}),e.jsx("div",{className:"w-full overflow-auto",children:e.jsxs("table",{className:"w-full text-sm table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-600",children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"Type"}),e.jsx("th",{className:"p-3",children:"Parent"}),e.jsx("th",{className:"p-3",children:"Members"}),e.jsx("th",{className:"p-3",children:"Default Role"}),e.jsx("th",{className:"p-3",children:"Active"}),e.jsx("th",{className:"p-3",children:"Actions"})]})}),e.jsxs("tbody",{children:[f&&f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-3 text-slate-500",children:"No groups found."})}),f&&f.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 align-top font-medium text-slate-800",children:t.GroupName}),e.jsx("td",{className:"p-3 align-top text-slate-600",children:t.GroupType||"-"}),e.jsx("td",{className:"p-3 align-top text-slate-600",children:t.ParentGroupName||"-"}),e.jsx("td",{className:"p-3 align-top text-slate-600",children:t.CanHaveMembers?"Yes":"No"}),e.jsx("td",{className:"p-3 align-top text-slate-600",children:t.DefaultRoleName||"-"}),e.jsx("td",{className:"p-3 align-top",children:t.IsActive?e.jsx("span",{className:"text-green-600",children:"Yes"}):e.jsx("span",{className:"text-red-600",children:"No"})}),e.jsx("td",{className:"p-3 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(t),className:"p-2 rounded-md hover:bg-gray-100",title:"Edit",children:e.jsx($,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(t),className:"p-2 rounded-md hover:bg-red-50 text-red-600",title:"Delete",children:e.jsx(B,{className:"h-4 w-4"})})]})})]},t.GroupID))]})]})})]})]}),e.jsx(q,{open:r.open,onClose:()=>l({open:!1,id:null,form:null}),title:r.form?`Edit: ${r.form.GroupName}`:"Edit Group",children:r.form&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Group Name"}),e.jsx("input",{value:r.form.GroupName,onChange:t=>l(s=>({...s,form:{...s.form,GroupName:t.target.value}})),className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Name (Amharic)"}),e.jsx("input",{value:r.form.GroupNameAmharic,onChange:t=>l(s=>({...s,form:{...s.form,GroupNameAmharic:t.target.value}})),className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Description"}),e.jsx("textarea",{value:r.form.GroupDescription,onChange:t=>l(s=>({...s,form:{...s.form,GroupDescription:t.target.value}})),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Type"}),e.jsx("select",{value:r.form.GroupType,onChange:t=>l(s=>({...s,form:{...s.form,GroupType:t.target.value}})),className:"w-full px-3 py-2 border rounded",children:C.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Parent Group"}),e.jsxs("select",{value:r.form.ParentGroupID||"",onChange:t=>l(s=>({...s,form:{...s.form,ParentGroupID:t.target.value||null}})),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"-- None --"}),v.map(t=>e.jsx("option",{value:t.GroupID,children:t.GroupName},t.GroupID))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Default Role"}),e.jsxs("select",{value:r.form.DefaultRoleID||"",onChange:t=>l(s=>({...s,form:{...s.form,DefaultRoleID:t.target.value||null}})),className:"w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"",children:"-- None --"}),G.map(t=>e.jsx("option",{value:t.RoleID,children:t.RoleName},t.RoleID))]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.form.IsSystemGroup,onChange:t=>l(s=>({...s,form:{...s.form,IsSystemGroup:t.target.checked}})),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"System Group"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.form.CanHaveMembers,onChange:t=>l(s=>({...s,form:{...s.form,CanHaveMembers:t.target.checked}})),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Can Have Members"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!r.form.IsActive,onChange:t=>l(s=>({...s,form:{...s.form,IsActive:t.target.checked}})),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>l({open:!1,id:null,form:null}),className:"px-4 py-2 rounded border",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:r.saving,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:r.saving?"Saving...":"Update"})]}),p&&e.jsx("div",{className:`text-sm ${p.type==="error"?"text-red-600":"text-green-600"}`,children:p.text})]})}),e.jsx(J,{open:h.open,title:h.title,message:h.message,onCancel:()=>g({open:!1,id:null,title:"",message:"",processing:!1}),onConfirm:L,confirmLabel:"Yes",cancelLabel:"No",loading:h.processing})]})}export{Z as default};
