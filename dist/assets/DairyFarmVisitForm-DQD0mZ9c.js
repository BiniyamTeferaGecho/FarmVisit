import{G,r as j,j as e,a5 as K,a6 as _,a7 as J,a4 as Q,a8 as X,a9 as Y}from"./index-gIg6QK8U.js";const Z=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],O=G("clipboard-list",Z);const ee=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],ae=G("droplet",ee),w=({title:v,icon:r,children:g})=>e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[r,e.jsx("h3",{className:"text-xl font-semibold ml-3 text-gray-800",children:v})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:g})]}),l=({label:v,name:r,value:g,onChange:C,type:f="text",step:a,placeholder:x,unit:t,readOnly:k=!1,disabled:A=!1,error:h})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left mb-1",children:v}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:f,name:r,value:g||"",onChange:C,step:a,placeholder:x,readOnly:k,disabled:A,className:`mt-1 block w-full rounded-md ${h?"border-red-500":"border-gray-300"} shadow-sm sm:text-base py-2 px-3 h-11 ${k||A?"bg-gray-100 cursor-not-allowed":"focus:border-indigo-500 focus:ring-indigo-500"}`}),t&&e.jsx("span",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm text-gray-500",children:t})]}),h&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:h})]}),L=({label:v,name:r,checked:g,onChange:C,disabled:f=!1})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:r,checked:!!g,onChange:C,disabled:f,className:`h-5 w-5 text-indigo-600 border-gray-300 rounded ${f?"opacity-60 cursor-not-allowed":"focus:ring-indigo-500"}`}),e.jsx("label",{className:"ml-2 block text-sm text-gray-900 text-left",children:v})]}),p=({label:v,name:r,value:g,onChange:C,placeholder:f,readOnly:a=!1,disabled:x=!1,error:t})=>e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left mb-1",children:v}),e.jsx("textarea",{name:r,rows:"4",value:g||"",onChange:C,placeholder:f,readOnly:a,disabled:x,className:`mt-1 block w-full rounded-md ${t?"border-red-500":"border-gray-300"} shadow-sm sm:text-base py-2 px-3 h-32 ${a||x?"bg-gray-100 cursor-not-allowed":"focus:border-indigo-500 focus:ring-indigo-500"}`}),t&&e.jsx("div",{className:"text-sm text-red-600 mt-1",children:t})]}),ie=({form:v,onChange:r,onSave:g,onCancel:C,loading:f,readOnly:a=!1,locationReadOnlyInModal:x=!1})=>{const t=v??{},[k,A]=j.useState([]),h=j.useRef([]),F=j.useRef(null),[E,T]=j.useState(!1),[U,I]=j.useState(!1),[$,P]=j.useState(null),D=j.useRef(null),[o,R]=j.useState({}),i=s=>{if(!s)return;const{name:n,value:c,type:m,checked:N}=s.target,M=m==="checkbox"?N:c;o&&o[n]&&R(S=>{const d={...S||{}};return delete d[n],d}),typeof r=="function"&&r({...t,[n]:M})},V=s=>{if(a)return;const n=s.target.files?Array.from(s.target.files):[];typeof r=="function"&&r({...t,AnyRelatedEvidenceImage:n}),h.current.forEach(m=>{try{URL.revokeObjectURL(m)}catch{}});const c=n.map(m=>URL.createObjectURL(m));h.current=c.slice(),A(c)},W=()=>{if(!a){if(!navigator||!navigator.geolocation){P("Geolocation not supported by this browser");return}I(!0),P(null);try{navigator.geolocation.getCurrentPosition(s=>{const n=s.coords.latitude.toFixed(6),c=s.coords.longitude.toFixed(6),m=`${n}, ${c}`;try{typeof r=="function"&&r({...t,Location:m})}catch{}T(!0),I(!1)},s=>{P(s?.message||"Failed to retrieve location"),I(!1)},{enableHighAccuracy:!0,timeout:1e4})}catch{P("Unable to request geolocation"),I(!1)}}};j.useEffect(()=>{if((a||t&&t.Location)&&T(!0),Array.isArray(t.AnyRelatedEvidenceImage)&&t.AnyRelatedEvidenceImage.length>0){const s=t.AnyRelatedEvidenceImage.map(n=>n instanceof File?URL.createObjectURL(n):String(n));h.current.forEach(n=>{try{URL.revokeObjectURL(n)}catch{}}),h.current=s.filter(n=>n.startsWith("blob:")),A(s)}return()=>{h.current.forEach(s=>{try{URL.revokeObjectURL(s)}catch{}}),h.current=[]}},[]);const q=()=>{const s={},n=u=>{if(u==null||u==="")return null;const b=Number(u);return Number.isFinite(b)?b:NaN};t.Location||(s.Location="Location is required"),["LactationCows","DryCows","Heifers","Calves","Buls"].forEach(u=>{const b=n(t[u]);b!==null&&(!Number.isFinite(b)||b<0)&&(s[u]=`${u} must be a number >= 0`)});const c=n(t.BodyCondition);c!==null&&!Number.isNaN(c)&&(c<1||c>5)&&(s.BodyCondition="Body condition must be between 1.0 and 5.0");const m=n(t.AgeAtFirstCalving);m!==null&&!Number.isNaN(m)&&(m<18||m>40)&&(s.AgeAtFirstCalving="Age at first calving must be between 18 and 40 months");const N=n(t.CalvingInterval);N!==null&&!Number.isNaN(N)&&(N<300||N>600)&&(s.CalvingInterval="Calving interval must be between 300 and 600 days");const M=n(t.ForageAmount);M!==null&&!Number.isNaN(M)&&(M<0||M>1e4)&&(s.ForageAmount="Forage amount must be between 0 and 10000"),["ManureScore1","ManureScore2","ManureScore3","ManureScore4"].forEach(u=>{const b=n(t[u]);b!==null&&(!Number.isFinite(b)||b<1||b>5)&&(s[u]=`${u} must be between 1 and 5`)});const S=n(t.MilkPricePerLitter);S!==null&&!Number.isNaN(S)&&S<0&&(s.MilkPricePerLitter="Milk price must be >= 0");const d=n(t.AvgMilkProductionPerDay),y=n(t.MaxMilkProductionPerCow);d!==null&&!Number.isNaN(d)&&(d<0||d>100)&&(s.AvgMilkProductionPerDay="Avg milk per day must be between 0 and 100 L"),y!==null&&!Number.isNaN(y)&&y<0&&(s.MaxMilkProductionPerCow="Max milk production must be >= 0"),d!==null&&y!==null&&!Number.isNaN(d)&&!Number.isNaN(y)&&d>y&&(s.AvgMilkProductionPerDay="Average production cannot exceed max production per cow");const B=n(t.LactationCows),H=n(t.TotalMilkPerDay);return B!==null&&d!==null&&H!==null&&!Number.isNaN(B)&&!Number.isNaN(d)&&!Number.isNaN(H)&&B>0&&d>0&&H>B*d*1.5&&(s.TotalMilkPerDay="Total milk exceeds reasonable maximum based on lactation cows and average production"),s},z=async()=>{const s=q();if(Object.keys(s).length){R(s),s.Location&&D.current&&D.current.focus();return}if(typeof g=="function")try{await g()}catch(n){console.error("parent onSave error",n)}};return e.jsx("div",{className:"p-4 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("input",{type:"hidden",name:"ScheduleID",value:t.ScheduleID||""}),e.jsxs(w,{title:"Visit Details",icon:e.jsx(K,{className:"text-indigo-600"}),children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left mb-1",children:"Location (lat, long)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:D,name:"Location",value:t.Location||"",onChange:s=>{o&&o.Location&&R(n=>{const c={...n};return delete c.Location,c}),i(s)},placeholder:"Latitude, Longitude",readOnly:a||E||x,disabled:a||x,className:`mt-1 block w-full rounded-md ${o&&o.Location?"border-red-500":"border-gray-300"} shadow-sm sm:text-base py-2 px-3 h-11 ${a||x?"bg-gray-100 cursor-not-allowed":"focus:border-indigo-500 focus:ring-indigo-500"}`}),!a&&!x&&e.jsx("button",{type:"button",onClick:W,className:"px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",disabled:U,children:U?"Getting...":"Get"}),!a&&E&&!x&&e.jsx("button",{type:"button",onClick:()=>{T(!1),P(null)},className:"px-2 py-2 bg-gray-200 text-sm rounded-md",children:"Edit"})]}),o&&o.Location?e.jsx("div",{className:"text-sm text-red-600 mt-1",children:o.Location}):$?e.jsx("div",{className:"text-sm text-red-600 mt-1",children:$}):e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Format: ",e.jsx("span",{className:"italic",children:"lat, long"})," — e.g. ",e.jsx("span",{className:"font-mono",children:"9.030000, 38.740000"}),". Click to auto-fill."]})]}),e.jsx(l,{label:"Lactation Cows",name:"LactationCows",type:"number",value:t.LactationCows,onChange:i,readOnly:a,disabled:a,error:o&&o.LactationCows}),e.jsx(l,{label:"Dry Cows",name:"DryCows",type:"number",value:t.DryCows,onChange:i,readOnly:a,disabled:a,error:o&&o.DryCows}),e.jsx(l,{label:"Heifers",name:"Heifers",type:"number",value:t.Heifers,onChange:i,readOnly:a,disabled:a,error:o&&o.Heifers}),e.jsx(l,{label:"Calves",name:"Calves",type:"number",value:t.Calves,onChange:i,readOnly:a,disabled:a,error:o&&o.Calves}),e.jsx(l,{label:"Bulls",name:"Buls",type:"number",value:t.Buls,onChange:i,readOnly:a,disabled:a,error:o&&o.Buls}),e.jsx(l,{label:"Body Condition",name:"BodyCondition",type:"number",step:"0.1",value:t.BodyCondition,onChange:i,readOnly:a,disabled:a,error:o&&o.BodyCondition}),e.jsx(l,{label:"Feeding Per Cow",name:"FeedingPerCow",value:t.FeedingPerCow,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"How They Give For Cows",name:"HowTheyGiveForCows",value:t.HowTheyGiveForCows||t.HowTheyGiveForCos,onChange:i,readOnly:a,disabled:a})]}),e.jsxs(w,{title:"Feeding & Forage",icon:e.jsx(O,{className:"text-green-600"}),children:[e.jsx(L,{label:"Uses Concentrate",name:"UsesConcentrate",checked:t.UsesConcentrate,onChange:i,disabled:a}),e.jsx(l,{label:"Which Company",name:"WhichCompany",value:t.WhichCompany,onChange:i,readOnly:a,disabled:a}),e.jsx(L,{label:"Is Local Mix",name:"IsLocalMix",checked:t.IsLocalMix,onChange:i,disabled:a}),e.jsx(p,{label:"List of Ingredients",name:"ListofIngridiant",value:t.ListofIngridiant,onChange:i,placeholder:"List ingredients...",readOnly:a,disabled:a}),e.jsx(p,{label:"Sample Collection",name:"SampleCollection",value:t.SampleCollection,onChange:i,placeholder:"Sample collection details...",readOnly:a,disabled:a}),e.jsx(L,{label:"Has Forage",name:"HasForage",checked:t.HasForage,onChange:i,disabled:a}),e.jsx(l,{label:"Type of Forage",name:"TypeOfForage",value:t.TypeOfForage,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Forage Amount",name:"ForageAmount",type:"number",value:t.ForageAmount,onChange:i,readOnly:a,disabled:a,error:o&&o.ForageAmount}),e.jsx(L,{label:"Concentrate Feed Sample",name:"ConcentrateFeedSample",checked:t.ConcentrateFeedSample,onChange:i,disabled:a}),e.jsx(l,{label:"How Many Times (feeding)",name:"HowManyTimes",value:t.HowManyTimes,onChange:i,readOnly:a,disabled:a}),e.jsx(p,{label:"Type of Feed (with complaint)",name:"TypeofFeedwithComplain",value:t.TypeofFeedwithComplain,onChange:i,placeholder:"Describe feed with complaint...",readOnly:a,disabled:a})]}),e.jsxs(w,{title:"Production & Water",icon:e.jsx(_,{className:"text-red-600"}),children:[e.jsx(l,{label:"Amount of Water Provided",name:"AmountofWaterProvided",value:t.AmountofWaterProvided,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Avg Milk Production/Day",name:"AvgMilkProductionPerDay",type:"number",step:"0.01",value:t.AvgMilkProductionPerDay,onChange:i,unit:"L/day",readOnly:a,disabled:a,error:o&&o.AvgMilkProductionPerDay}),e.jsx(l,{label:"Max Milk Production/Cow",name:"MaxMilkProductionPerCow",type:"number",step:"0.01",value:t.MaxMilkProductionPerCow,onChange:i,unit:"L",readOnly:a,disabled:a,error:o&&o.MaxMilkProductionPerCow}),e.jsx(l,{label:"Total Milk/Day",name:"TotalMilkPerDay",type:"number",step:"0.01",value:t.TotalMilkPerDay,onChange:i,unit:"L",readOnly:a,disabled:a,error:o&&o.TotalMilkPerDay}),e.jsx(l,{label:"Milk Supply To",name:"MilkSupplyTo",value:t.MilkSupplyTo,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Milk Price/Liter",name:"MilkPricePerLitter",type:"number",step:"0.01",value:t.MilkPricePerLitter,onChange:i,unit:"ETB/L",readOnly:a,disabled:a,error:o&&o.MilkPricePerLitter}),e.jsxs("div",{className:"col-span-1 md:col-span-2 grid grid-cols-4 gap-4",children:[e.jsx(l,{label:"Manure Score 1",name:"ManureScore1",type:"number",value:t.ManureScore1,onChange:i,readOnly:a,disabled:a,error:o&&o.ManureScore1}),e.jsx(l,{label:"Manure Score 2",name:"ManureScore2",type:"number",value:t.ManureScore2,onChange:i,readOnly:a,disabled:a,error:o&&o.ManureScore2}),e.jsx(l,{label:"Manure Score 3",name:"ManureScore3",type:"number",value:t.ManureScore3,onChange:i,readOnly:a,disabled:a,error:o&&o.ManureScore3}),e.jsx(l,{label:"Manure Score 4",name:"ManureScore4",type:"number",value:t.ManureScore4,onChange:i,readOnly:a,disabled:a,error:o&&o.ManureScore4})]})]}),e.jsxs(w,{title:"Reproduction & Breeding",icon:e.jsx(ae,{className:"text-blue-600"}),children:[e.jsx(p,{label:"Breeding History",name:"BreedingHistory",value:t.BreedingHistory,onChange:i,placeholder:"Breeding history...",readOnly:a,disabled:a}),e.jsx(l,{label:"Breeding Method",name:"BreedingMethod",value:t.BreedingMethod,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Natural or AI?",name:"AreTheyUsingNaturalorAI",value:t.AreTheyUsingNaturalorAI,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Insemination Frequency",name:"InseminationFrequency",value:t.InseminationFrequency,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Calving Interval",name:"CalvingInterval",type:"number",value:t.CalvingInterval,onChange:i,readOnly:a,disabled:a,error:o&&o.CalvingInterval}),e.jsx(l,{label:"Age at First Calving",name:"AgeAtFirstCalving",type:"number",value:t.AgeAtFirstCalving,onChange:i,readOnly:a,disabled:a,error:o&&o.AgeAtFirstCalving})]}),e.jsxs(w,{title:"Health, Medication & Advice",icon:e.jsx(J,{className:"text-purple-600"}),children:[e.jsx(L,{label:"Medication",name:"Medication",checked:t.Medication,onChange:i,disabled:a}),e.jsx(p,{label:"Vaccination History",name:"VaccinationHistory",value:t.VaccinationHistory,onChange:i,placeholder:"Vaccination history...",readOnly:a,disabled:a}),e.jsx(p,{label:"What Type of Medication",name:"WhatTypeofMedication",value:t.WhatTypeofMedication,onChange:i,placeholder:"Describe medications...",readOnly:a,disabled:a}),e.jsx(p,{label:"Issues / Complaints",name:"IssuesComplaints",value:t.IssuesComplaints,onChange:i,readOnly:a,disabled:a}),e.jsx(p,{label:"Analysis Requested",name:"AnalyzeRequested",value:t.AnalyzeRequested,onChange:i,readOnly:a,disabled:a}),e.jsx(p,{label:"Recommendation / Advice",name:"RecommendationAdvice",value:t.RecommendationAdvice,onChange:i,readOnly:a,disabled:a}),e.jsx(p,{label:"Feedback on AKF",name:"FeedBackOnAKF",value:t.FeedBackOnAKF,onChange:i,readOnly:a,disabled:a})]}),e.jsxs(w,{title:"Housing & Environment",icon:e.jsx(Q,{className:"text-yellow-600"}),children:[e.jsx(l,{label:"Ventilation",name:"Ventilation",value:t.Ventilation,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Light Intensity",name:"LightIntensity",value:t.LightIntensity,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Bedding Type",name:"BeddingType",value:t.BeddingType,onChange:i,readOnly:a,disabled:a}),e.jsx(l,{label:"Space Availability",name:"SpaceAvailability",value:t.SpaceAvailability,onChange:i,readOnly:a,disabled:a})]}),e.jsx(w,{title:"Sampling & Evidence",icon:e.jsx(Y,{className:"text-teal-600"}),children:e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 text-left mb-1",children:"Related Evidence Image"}),e.jsxs("div",{className:`mt-1 flex items-center justify-center px-4 py-6 border-2 border-dashed border-gray-300 rounded-md bg-white ${a?"opacity-60 cursor-not-allowed":"hover:border-indigo-500 cursor-pointer"}`,onClick:()=>{!a&&F.current&&F.current.click()},onDragOver:s=>{a||s.preventDefault()},onDrop:s=>{a||(s.preventDefault(),V({target:{files:s.dataTransfer.files}}))},role:"button",tabIndex:0,onKeyDown:s=>{!a&&(s.key==="Enter"||s.key===" ")&&F.current&&F.current.click()},children:[e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"mx-auto text-indigo-600",size:36}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Drag & drop images here, or click to browse"}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"PNG, JPG — up to 10MB"})]}),e.jsx("input",{ref:F,type:"file",name:"AnyRelatedEvidenceImage",accept:"image/*",multiple:!0,onChange:V,className:"hidden",disabled:a})]}),k&&k.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:k.map((s,n)=>e.jsx("div",{className:"w-24 h-24 rounded overflow-hidden border",children:e.jsx("img",{src:s,alt:`preview-${n}`,className:"w-full h-full object-cover"})},n))}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(L,{label:"Sample Taken",name:"SampleTaken",checked:t.SampleTaken,onChange:i,disabled:a})}),e.jsx("div",{children:e.jsx(l,{label:"Batch Number",name:"BatchNumber",value:t.BatchNumber,onChange:i,readOnly:a,disabled:a})})]})]})}),a?e.jsx("div",{className:"sticky bottom-0 bg-white border-t p-4 mt-8",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end",children:e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Close"})})}):e.jsx("div",{className:"sticky bottom-0 bg-white border-t p-4 mt-8",children:e.jsx("div",{className:"max-w-4xl mx-auto flex justify-end space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:z,disabled:f,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-indigo-300",children:f?"Saving...":"Save Visit"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancel"})]})})})]})})};export{ie as D};
