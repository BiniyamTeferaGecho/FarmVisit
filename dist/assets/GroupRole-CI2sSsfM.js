import{u as K,r as l,j as s,P as k,ak as O,T as Q,M as G,C as V}from"./index-gIg6QK8U.js";function N(r){return r&&(r.UserID||r.userId||r.UserId||r.id||r.ID)}function Z(){const{user:r,fetchWithAuth:i}=K(),[y,A]=l.useState([]),[P,R]=l.useState(!1),[x,o]=l.useState(null),[g,T]=l.useState({totalCount:0,currentPage:1,pageSize:25}),[b,B]=l.useState([]),[C,E]=l.useState([]),[n,v]=l.useState({GroupID:"",RoleID:"",IsActive:!0}),[M,w]=l.useState(!1),[m,d]=l.useState({open:!1,id:null,form:null,saving:!1}),[h,D]=l.useState({open:!1,id:null,title:"",message:"",processing:!1}),[f,p]=l.useState({open:!1,GroupID:"",RoleIDs:[],processing:!1}),[j,u]=l.useState({open:!1,SourceGroupID:"",TargetGroupID:"",processing:!1}),I=async(e=1)=>{R(!0);try{const t=await i({url:"/group-roles",method:"get",params:{page:e,pageSize:g.pageSize}}),a=t.data&&t.data.data?t.data.data:t.data||[];A(a.items||t.data||a||[]),T(c=>({...c,currentPage:e,totalCount:t.data&&t.data.totalCount||a.totalCount||a.length||0}))}catch(t){console.error("fetchGroupRoles error",t),o({type:"error",text:t?.response?.data?.message||t.message||"Failed to load group roles"})}finally{R(!1)}},F=async()=>{try{const e=await i({url:"/groups",method:"get",params:{page:1,pageSize:1e3}}),t=e.data&&e.data.data?e.data.data:e.data||{items:[]};B(t.items||[])}catch(e){console.warn("fetchGroups",e)}},$=async()=>{try{const e=await i({url:"/roles",method:"get",params:{page:1,pageSize:1e3}}),t=e.data&&e.data.data?e.data.data:e.data||{items:[]};E(t.items||[])}catch(e){console.warn("fetchRoles",e)}};l.useEffect(()=>{I(1),F(),$()},[]);const S=()=>v({GroupID:"",RoleID:"",IsActive:!0}),L=async e=>{if(e.preventDefault(),o(null),!n.GroupID||!n.RoleID){o({type:"error",text:"Group and Role are required"});return}const t=N(r);if(!t){o({type:"error",text:"You must be signed in to assign roles."});return}w(!0);try{const a={GroupID:n.GroupID,RoleID:n.RoleID,IsActive:n.IsActive?1:0,CreatedBy:t};await i({url:"/group-roles",method:"post",data:a}),o({type:"success",text:"Role assigned to group"}),S(),await I(1)}catch(a){console.error("createGroupRole error",a),o({type:"error",text:a?.response?.data?.message||a.message||"Failed to assign role"})}finally{w(!1)}},U=e=>d({open:!0,id:e.GroupRoleID||e.Id||null,form:{IsActive:!!e.IsActive},saving:!1}),z=async()=>{const{id:e,form:t}=m;if(!e)return;const a=N(r);d(c=>({...c,saving:!0}));try{await i({url:`/group-roles/${e}`,method:"put",data:{IsActive:t.IsActive?1:0,UpdatedBy:a}}),o({type:"success",text:"Updated"}),d({open:!1,id:null,form:null,saving:!1}),await I(g.currentPage)}catch(c){console.error("updateGroupRole error",c),o({type:"error",text:c?.response?.data?.message||c.message||"Failed to update"}),d(J=>({...J,saving:!1}))}},Y=e=>D({open:!0,id:e.GroupRoleID||e.Id||null,title:"Delete role assignment",message:"Remove this role from the group?",processing:!1}),q=async()=>{if(h.open){D(e=>({...e,processing:!0}));try{if(!N(r))throw new Error("You must be signed in to remove roles.");await i({url:`/group-roles/${h.id}`,method:"delete"}),o({type:"success",text:"Removed"}),await I(g.currentPage)}catch(e){console.error("deleteGroupRole error",e),o({type:"error",text:e?.response?.data?.message||e.message||"Failed to remove role"})}finally{D({open:!1,id:null,title:"",message:"",processing:!1})}}},W=async()=>{const e=f;if(!e.GroupID||!Array.isArray(e.RoleIDs)||e.RoleIDs.length===0){o({type:"error",text:"Select a group and at least one role"});return}p(t=>({...t,processing:!0}));try{const t=N(r);await i({url:"/group-roles/bulk-assign",method:"post",data:{GroupID:e.GroupID,RoleIDs:e.RoleIDs,CreatedBy:t}}),o({type:"success",text:"Roles assigned"}),p({open:!1,GroupID:"",RoleIDs:[],processing:!1}),await I(g.currentPage)}catch(t){console.error("bulkAssign error",t),o({type:"error",text:t?.response?.data?.message||t.message||"Failed to assign roles"}),p(a=>({...a,processing:!1}))}},H=async()=>{const e=j;if(!e.SourceGroupID||!e.TargetGroupID){o({type:"error",text:"Select source and target group"});return}u(t=>({...t,processing:!0}));try{const t=N(r);await i({url:"/group-roles/copy",method:"post",data:{SourceGroupID:e.SourceGroupID,TargetGroupID:e.TargetGroupID,CreatedBy:t}}),o({type:"success",text:"Copied roles"}),u({open:!1,SourceGroupID:"",TargetGroupID:"",processing:!1}),await I(g.currentPage)}catch(t){console.error("copyGroupRoles error",t),o({type:"error",text:t?.response?.data?.message||t.message||"Failed to copy roles"}),u(a=>({...a,processing:!1}))}};return s.jsxs("div",{className:"space-y-6 h-full",children:[s.jsxs("header",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Group Roles"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Assign roles to groups and manage group-role assignments."})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>p(e=>({...e,open:!0})),className:"px-3 py-2 border rounded",children:"Bulk Assign"}),s.jsx("button",{onClick:()=>u(e=>({...e,open:!0})),className:"px-3 py-2 border rounded",children:"Copy Roles"}),s.jsxs("button",{onClick:()=>d({open:!0,id:null,form:{...n},saving:!1}),className:"inline-flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded-md text-sm",children:[" ",s.jsx(k,{className:"h-4 w-4"})," New"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-1 bg-white p-6 rounded-lg shadow-sm text-left",children:[s.jsx("h3",{className:"text-lg font-medium mb-4",children:"Assign Role"}),s.jsxs("form",{onSubmit:L,className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Group"}),s.jsxs("select",{value:n.GroupID||"",onChange:e=>v(t=>({...t,GroupID:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"-- Select group --"}),b.map(e=>s.jsx("option",{value:e.GroupID,children:e.GroupName},e.GroupID))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Role"}),s.jsxs("select",{value:n.RoleID||"",onChange:e=>v(t=>({...t,RoleID:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"-- Select role --"}),C.map(e=>s.jsx("option",{value:e.RoleID,children:e.RoleName},e.RoleID))]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:n.IsActive,onChange:e=>v(t=>({...t,IsActive:e.target.checked})),className:"form-checkbox h-4 w-4"}),s.jsx("span",{children:"Active"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{type:"submit",disabled:M,className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md",children:[" ",s.jsx(k,{className:"h-4 w-4"})," Create"]}),s.jsx("button",{type:"button",onClick:S,className:"px-3 py-2 border rounded-md",children:"Reset"})]}),x&&s.jsx("div",{className:`text-sm ${x.type==="error"?"text-red-600":"text-green-600"}`,children:x.text})]})]}),s.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow-sm overflow-auto text-left",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"All Group Roles"}),s.jsx("div",{className:"text-sm text-slate-500",children:P?"Loading...":`${g.totalCount||y.length||0} assignments`})]}),s.jsx("div",{className:"w-full overflow-auto",children:s.jsxs("table",{className:"w-full text-sm table-auto text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"text-left text-slate-600",children:[s.jsx("th",{className:"p-3",children:"Group"}),s.jsx("th",{className:"p-3",children:"Role"}),s.jsx("th",{className:"p-3",children:"Active"}),s.jsx("th",{className:"p-3",children:"Actions"})]})}),s.jsxs("tbody",{children:[y&&y.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-3 text-slate-500",children:"No assignments found."})}),y&&y.map(e=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"p-3 align-top font-medium text-slate-800",children:e.GroupName||e.Group||"-"}),s.jsx("td",{className:"p-3 align-top text-slate-600",children:e.RoleName||e.Role||"-"}),s.jsx("td",{className:"p-3 align-top",children:e.IsActive?s.jsx("span",{className:"text-green-600",children:"Yes"}):s.jsx("span",{className:"text-red-600",children:"No"})}),s.jsx("td",{className:"p-3 align-top",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>U(e),className:"p-2 rounded-md hover:bg-gray-100",title:"Edit",children:s.jsx(O,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>Y(e),className:"p-2 rounded-md hover:bg-red-50 text-red-600",title:"Delete",children:s.jsx(Q,{className:"h-4 w-4"})})]})})]},e.GroupRoleID||e.Id||`${e.GroupID}-${e.RoleID}`))]})]})})]})]}),s.jsx(G,{open:m.open,onClose:()=>d({open:!1,id:null,form:null}),title:m.form?"Edit":"Edit Group Role",children:m.form&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:!!m.form.IsActive,onChange:e=>d(t=>({...t,form:{...t.form,IsActive:e.target.checked}})),className:"form-checkbox h-4 w-4"}),s.jsx("span",{children:"Active"})]})}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>d({open:!1,id:null,form:null}),className:"px-4 py-2 rounded border",children:"Cancel"}),s.jsx("button",{onClick:z,disabled:m.saving,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:m.saving?"Saving...":"Update"})]}),x&&s.jsx("div",{className:`text-sm ${x.type==="error"?"text-red-600":"text-green-600"}`,children:x.text})]})}),s.jsx(G,{open:f.open,onClose:()=>p({open:!1,GroupID:"",RoleIDs:[],processing:!1}),title:"Bulk Assign Roles",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm block mb-1",children:"Group"}),s.jsxs("select",{value:f.GroupID||"",onChange:e=>p(t=>({...t,GroupID:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"-- Select group --"}),b.map(e=>s.jsx("option",{value:e.GroupID,children:e.GroupName},e.GroupID))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm block mb-1",children:"Roles"}),s.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-auto border p-2 rounded",children:C.map(e=>s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:f.RoleIDs.includes(e.RoleID),onChange:t=>p(a=>({...a,RoleIDs:t.target.checked?[...a.RoleIDs,e.RoleID]:a.RoleIDs.filter(c=>c!==e.RoleID)}))}),e.RoleName]},e.RoleID))})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>p({open:!1,GroupID:"",RoleIDs:[],processing:!1}),className:"px-3 py-2 border rounded",children:"Cancel"}),s.jsx("button",{onClick:W,disabled:f.processing,className:"px-3 py-2 bg-indigo-600 text-white rounded",children:f.processing?"Processing...":"Assign"})]})]})}),s.jsx(G,{open:j.open,onClose:()=>u({open:!1,SourceGroupID:"",TargetGroupID:"",processing:!1}),title:"Copy Roles Between Groups",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm block mb-1",children:"Source Group"}),s.jsxs("select",{value:j.SourceGroupID||"",onChange:e=>u(t=>({...t,SourceGroupID:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"-- Select source --"}),b.map(e=>s.jsx("option",{value:e.GroupID,children:e.GroupName},e.GroupID))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm block mb-1",children:"Target Group"}),s.jsxs("select",{value:j.TargetGroupID||"",onChange:e=>u(t=>({...t,TargetGroupID:e.target.value})),className:"w-full px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"-- Select target --"}),b.map(e=>s.jsx("option",{value:e.GroupID,children:e.GroupName},e.GroupID))]})]}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx("button",{onClick:()=>u({open:!1,SourceGroupID:"",TargetGroupID:"",processing:!1}),className:"px-3 py-2 border rounded",children:"Cancel"}),s.jsx("button",{onClick:H,disabled:j.processing,className:"px-3 py-2 bg-indigo-600 text-white rounded",children:j.processing?"Processing...":"Copy"})]})]})}),s.jsx(V,{open:h.open,title:h.title,message:h.message,onCancel:()=>D({open:!1,id:null,title:"",message:"",processing:!1}),onConfirm:q,confirmLabel:"Yes",cancelLabel:"No",loading:h.processing})]})}export{Z as default};
