import{G as b,u as E,a as I,r as i,j as e,R as M,a1 as L,ag as F,ah as _,ai as R,aj as D}from"./index-gIg6QK8U.js";import{U as A}from"./user-DBa84ajX.js";import{S as $}from"./save-DdPekitn.js";const O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],q=b("globe",O);const G=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],W=b("log-in",G);const B=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],H=b("mail",B);const K=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Y=b("phone",K),g=({icon:o,label:h,value:l,onChange:u,type:d="text"})=>e.jsxs("div",{children:[e.jsx("label",{className:"text-left block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:h}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400",children:o}),e.jsx("input",{type:d,value:l,onChange:u,className:"w-full mt-1 p-2 pl-10 border rounded-lg bg-slate-50 dark:bg-slate-700 border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),J=({icon:o,label:h,value:l,onChange:u,options:d})=>e.jsxs("div",{children:[e.jsx("label",{className:"text-left block text-sm font-medium text-slate-600 dark:text-slate-300 mb-1",children:h}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-slate-400",children:o}),e.jsx("select",{value:l,onChange:u,className:"w-full mt-1 p-2 pl-10 border rounded-lg appearance-none bg-slate-50 dark:bg-slate-700 border-slate-300 dark:border-slate-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:d.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]})]});function ee({modal:o=!1,reloadKey:h}){const{user:l,setAuth:u,accessToken:d,fetchWithAuth:n}=E(),C=I(),[T,f]=i.useState(!0),[N,k]=i.useState(!1),[a,w]=i.useState({}),[j,x]=i.useState(null),[P,v]=i.useState(!1),p=i.useRef(!0),m=l?.userId||l?.UserID||l?.id||l?.userId||null;async function S(){if(!m){f(!1);return}try{f(!0),v(!1),x(null);const s=await n({url:`/users/${encodeURIComponent(m)}/profile`,method:"get",redirectOnFail:!1}),t=s?.data?.data??s?.data??s;if(!p.current)return;w(t||{})}catch(s){console.error("Failed to load profile",s);const t=s?.response?.data?.message||s.message||"Failed to load profile";(s?.response?.status===401||/invalid|expired|missing refresh/i.test(t))&&v(!0),x({type:"error",text:t})}finally{p.current&&f(!1)}}i.useEffect(()=>(p.current=!0,S(),()=>{p.current=!1}),[m,n]);const c=(s,t)=>w(r=>({...r,[s]:t})),U=async s=>{s&&s.preventDefault(),k(!0),x(null);try{const t={UserID:a.UserID||m,Username:a.Username||a.username||a.UserName,Email:a.Email||a.email,PhoneNumber:a.PhoneNumber||a.phoneNumber,Timezone:a.Timezone||a.timezone||null,Language:a.Language||a.language||null,Theme:a.Theme||a.theme||null,UpdatedBy:m},r=await n({url:"/users/profile",method:"put",data:t,redirectOnFail:!1}),y=r?.data?.data??r?.data??null;if(x({type:"success",text:r?.data?.message||"Profile updated successfully!"}),y){u(d&&d||null,y);try{window.dispatchEvent(new CustomEvent("profile-updated",{detail:y}))}catch{}}}catch(t){console.error("Failed to update profile",t);const r=t?.response?.data?.message||t.message||"Failed to update profile";(t?.response?.status===401||/invalid|expired|missing refresh/i.test(r))&&v(!0),x({type:"error",text:r})}finally{k(!1)}},z=e.jsxs("div",{className:o?"w-full max-w-2xl mx-auto":"max-w-4xl mx-auto",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-left text-3xl font-bold text-slate-900 dark:text-white",children:"Profile Settings"}),e.jsx("p",{className:"text-left text-md text-slate-600 dark:text-slate-400 mt-1",children:"Manage your account details and preferences."})]}),P&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200 flex items-center justify-between",children:[e.jsx("div",{children:"Your session has expired. Please sign in again to continue."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>C("/login",{state:{from:"/profile"}}),className:"px-4 py-2 bg-yellow-600 text-white rounded-lg flex items-center gap-2 hover:bg-yellow-700",children:[e.jsx(W,{size:16})," Sign In"]}),e.jsxs("button",{onClick:()=>S(),className:"px-4 py-2 border rounded-lg flex items-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700",children:[e.jsx(M,{size:16})," Retry"]})]})]}),j&&e.jsx("div",{className:`mb-4 p-4 rounded-lg ${j.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-200":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200"}`,children:j.text}),T?e.jsx("div",{className:"text-left p-8",children:"Loading profile..."}):e.jsxs("form",{onSubmit:U,className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-left text-xl font-semibold text-slate-800 dark:text-slate-100",children:"Personal Information"}),e.jsx(g,{icon:e.jsx(A,{size:18}),label:"Username",value:a.Username??a.username??"",onChange:s=>c("Username",s.target.value)}),e.jsx(g,{icon:e.jsx(H,{size:18}),label:"Email",type:"email",value:a.Email??a.email??"",onChange:s=>c("Email",s.target.value)}),e.jsx(g,{icon:e.jsx(Y,{size:18}),label:"Phone",value:a.PhoneNumber??a.phoneNumber??"",onChange:s=>c("PhoneNumber",s.target.value)})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-left text-xl font-semibold text-slate-800 dark:text-slate-100",children:"Settings"}),e.jsx(g,{icon:e.jsx(L,{size:18}),label:"Timezone",value:a.Timezone??"",onChange:s=>c("Timezone",s.target.value)}),e.jsx(g,{icon:e.jsx(q,{size:18}),label:"Language",value:a.Language??"",onChange:s=>c("Language",s.target.value)}),e.jsx(J,{icon:a.Theme==="dark"?e.jsx(F,{size:18}):e.jsx(_,{size:18}),label:"Theme",value:a.Theme??"",onChange:s=>c("Theme",s.target.value),options:[{value:"",label:"System"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]})]})]}),e.jsx("div",{className:"flex justify-end mt-8 pt-6 border-t border-slate-200 dark:border-slate-700",children:e.jsx("button",{type:"submit",disabled:N,className:"px-6 py-3 bg-blue-600 text-white rounded-lg flex items-center gap-2 hover:bg-blue-700 disabled:bg-blue-400",children:N?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx($,{size:18})," Save Changes"]})})})]})]});return o?z:e.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-900",children:[e.jsx("div",{style:{height:70},className:"fixed top-0 left-0 right-0 z-30",children:e.jsx(R,{onToggleSidebar:()=>{},onToggleCollapse:()=>{}})}),e.jsxs("div",{style:{paddingTop:70},className:"flex",children:[e.jsx(D,{isOpen:!1,isCollapsed:!1,active:"dashboard",onChange:()=>{},onClose:()=>{},width:72,minWidth:64}),e.jsx("main",{className:"flex-1 p-6",children:z})]})]})}export{ee as default};
