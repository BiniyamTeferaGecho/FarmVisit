import{u as U,r as a,j as e}from"./index-gIg6QK8U.js";function z(){const{user:n,fetchWithAuth:g}=U(),p=n&&(n.UserID||n.userId||n.id||n.UserId),[d,r]=a.useState(1),[j]=a.useState(10),[v,S]=a.useState([]),[y,b]=a.useState(0),[w,D]=a.useState(!1),[c,V]=a.useState(""),[o,A]=a.useState(""),[u,F]=a.useState(""),[x,I]=a.useState(""),[m,P]=a.useState("VisitDate"),[h,C]=a.useState("desc"),[E,M]=a.useState([]);a.useEffect(()=>{let t=!0;async function N(){if(p){D(!0);try{const s=new URLSearchParams;s.set("AdvisorID",p),s.set("page",String(d)),s.set("pageSize",String(j)),c&&s.set("q",c),o&&s.set("status",o),u&&s.set("StartDate",u),x&&s.set("EndDate",x),m&&s.set("sortBy",m),h&&s.set("sortDir",h);const B=`/farm-visit/advisor?${s.toString()}`,i=await g({url:B,method:"get"}),l=i?.data;if(!t)return;if(l&&l.success&&l.data){S(l.data.items||[]),b(l.data.total||0);const L=Array.from(new Set((l.data.items||[]).map(q=>q.VisitStatusName).filter(Boolean)));M(L)}else i&&i.data&&Array.isArray(i.data)&&(S(i.data),b(i.data.length))}catch(s){console.error("Failed to fetch advisor visits",s)}finally{t&&D(!1)}}}return N(),()=>{t=!1}},[p,g,d,j,c,o,u,x,m,h]);const f=Math.max(1,Math.ceil((y||0)/j));return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 gap-3 flex-wrap",children:[e.jsx("h3",{className:"text-lg font-medium",children:"My Scheduled Visits"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:c,onChange:t=>{V(t.target.value),r(1)},placeholder:"Search farm or purpose",className:"p-1 border rounded text-sm"}),e.jsxs("select",{value:o,onChange:t=>{A(t.target.value),r(1)},className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"",children:"All status"}),E.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"date",value:u,onChange:t=>{F(t.target.value),r(1)},className:"p-1 border rounded text-sm"}),e.jsx("input",{type:"date",value:x,onChange:t=>{I(t.target.value),r(1)},className:"p-1 border rounded text-sm"}),e.jsxs("select",{value:m+"|"+h,onChange:t=>{const[N,s]=t.target.value.split("|");P(N),C(s),r(1)},className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"VisitDate|desc",children:"Date (newest)"}),e.jsx("option",{value:"VisitDate|asc",children:"Date (oldest)"}),e.jsx("option",{value:"FarmName|asc",children:"Farm (A→Z)"}),e.jsx("option",{value:"FarmName|desc",children:"Farm (Z→A)"})]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded shadow",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"text-left bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Farm"}),e.jsx("th",{className:"px-3 py-2",children:"Date"}),e.jsx("th",{className:"px-3 py-2",children:"Purpose"}),e.jsx("th",{className:"px-3 py-2",children:"Status"}),e.jsx("th",{className:"px-3 py-2",children:"Priority"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-4 text-center",children:"Loading…"})}):v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-4 text-center text-sm text-gray-500",children:"No visits found."})}):v.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:t.FarmName||t.FarmID}),e.jsx("td",{className:"px-3 py-2",children:t.VisitDate?new Date(t.VisitDate).toLocaleString():"-"}),e.jsx("td",{className:"px-3 py-2",children:t.VisitPurpose||"-"}),e.jsx("td",{className:"px-3 py-2",children:t.VisitStatusName||"-"}),e.jsx("td",{className:"px-3 py-2",children:t.VisitPriority||"-"})]},t.VisitID))})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[y," visits"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(t=>Math.max(1,t-1)),disabled:d<=1,className:"px-2 py-1 border rounded bg-white",children:"Prev"}),e.jsxs("div",{className:"px-2",children:[d," / ",f]}),e.jsx("button",{onClick:()=>r(t=>Math.min(f,t+1)),disabled:d>=f,className:"px-2 py-1 border rounded bg-white",children:"Next"})]})]})]})}export{z as default};
