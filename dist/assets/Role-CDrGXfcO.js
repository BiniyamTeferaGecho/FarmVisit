import{u as Y,r as i,j as e,P as $,ak as z,T as L,M as U,C as q}from"./index-gIg6QK8U.js";function j(n){return n&&(n.UserID||n.userId||n.UserId||n.id||n.ID)}function W(){const{user:n,fetchWithAuth:p}=Y(),[f,S]=i.useState([]),[m,I]=i.useState({totalCount:0,currentPage:1,pageSize:25}),[k,y]=i.useState(!1),[N,l]=i.useState(null),[b,C]=i.useState(""),[r,h]=i.useState({RoleName:"",RoleDescription:"",IsActive:!0,IsSystemRole:!1}),[D,R]=i.useState(!1),[o,c]=i.useState({open:!1,id:null,form:null,saving:!1}),[x,g]=i.useState({open:!1,id:null,title:"",message:"",processing:!1}),u=async(s=1)=>{y(!0);try{const t=await p({url:"/roles",method:"get",params:{page:s,pageSize:m.pageSize,q:b}}),a=t.data&&t.data.data?t.data.data:t.data||{items:[]};S(a.items||[]),I(a.pagination||{totalCount:a.items.length||0,currentPage:s,pageSize:m.pageSize})}catch(t){console.error("fetchRoles error",t),l({type:"error",text:t?.response?.data?.message||t.message||"Failed to load roles"})}finally{y(!1)}};i.useEffect(()=>{u(m.currentPage)},[]);const v=()=>h({RoleName:"",RoleDescription:"",IsActive:!0,IsSystemRole:!1}),A=async s=>{if(s.preventDefault(),l(null),!r.RoleName){l({type:"error",text:"Role name is required"});return}const t=j(n);if(!t){l({type:"error",text:"You must be signed in to create roles."});return}R(!0);try{const a={RoleName:r.RoleName.trim(),RoleDescription:r.RoleDescription||null,IsSystemRole:r.IsSystemRole?1:0,IsActive:r.IsActive?1:0,CreatedBy:t},d=await p({url:"/roles",method:"post",data:a});l({type:"success",text:"Role created"}),v(),await u(1)}catch(a){console.error("createRole error",a),l({type:"error",text:a?.response?.data?.message||a.message||"Failed to create role"})}finally{R(!1)}},E=s=>{c({open:!0,id:s.RoleID,form:{RoleName:s.RoleName,RoleDescription:s.RoleDescription||"",IsActive:!!s.IsActive,IsSystemRole:!!s.IsSystemRole},saving:!1})},P=async()=>{const{id:s,form:t}=o;if(!t.RoleName){l({type:"error",text:"Role name is required"});return}const a=j(n);if(!a){l({type:"error",text:"You must be signed in to update roles."});return}c(d=>({...d,saving:!0}));try{const d={RoleName:t.RoleName.trim(),RoleDescription:t.RoleDescription||null,IsActive:t.IsActive?1:0,UpdatedBy:a},w=await p({url:`/roles/${s}`,method:"patch",data:d});l({type:"success",text:"Role updated"}),c({open:!1,id:null,form:null,saving:!1}),await u(m.currentPage)}catch(d){console.error("updateRole error",d),l({type:"error",text:d?.response?.data?.message||d.message||"Failed to update role"}),c(w=>({...w,saving:!1}))}},B=s=>{g({open:!0,id:s.RoleID,title:`Delete ${s.RoleName}`,message:"Soft-delete this role?",processing:!1})},F=async()=>{if(x.open){g(s=>({...s,processing:!0}));try{const s=j(n);if(!s)throw new Error("You must be signed in to delete roles.");await p({url:`/roles/${x.id}/delete`,method:"post",data:{DeletedBy:s}}),l({type:"success",text:"Role deleted"}),await u(m.currentPage)}catch(s){console.error("deleteRole error",s),l({type:"error",text:s?.response?.data?.message||s.message||"Failed to delete role"})}finally{g({open:!1,id:null,title:"",message:"",processing:!1})}}},M=async(s,t=null)=>{if(!s)return!1;try{return(await p({url:"/roles/check-name",method:"get",params:{RoleName:s,ExcludeRoleID:t}}))?.data?.data?.exists||!1}catch{return!1}};return e.jsxs("div",{className:"space-y-6 h-full",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Roles"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create and manage application roles."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{placeholder:"Search",value:b,onChange:s=>C(s.target.value),className:"px-3 py-2 border rounded"}),e.jsx("button",{onClick:()=>u(1),className:"px-3 py-2 bg-white border rounded-md text-sm",children:"Search"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-white p-6 rounded-lg shadow-sm text-left",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"New Role"}),e.jsxs("form",{onSubmit:A,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Role Name"}),e.jsx("input",{value:r.RoleName,onChange:s=>h({...r,RoleName:s.target.value}),onBlur:async s=>{await M(s.target.value||"")&&l({type:"error",text:"Role name already exists"})},className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 block mb-1",children:"Description"}),e.jsx("textarea",{value:r.RoleDescription,onChange:s=>h({...r,RoleDescription:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:r.IsSystemRole,onChange:s=>h({...r,IsSystemRole:s.target.checked}),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"System Role"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:r.IsActive,onChange:s=>h({...r,IsActive:s.target.checked}),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"submit",disabled:D,className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md",children:[" ",e.jsx($,{className:"h-4 w-4"})," Create"]}),e.jsx("button",{type:"button",onClick:v,className:"px-3 py-2 border rounded-md",children:"Reset"})]}),N&&e.jsx("div",{className:`text-sm ${N.type==="error"?"text-red-600":"text-green-600"}`,children:N.text})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-lg shadow-sm overflow-auto text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"All Roles"}),e.jsx("div",{className:"text-sm text-slate-500",children:k?"Loading...":`${m.totalCount||0} roles`})]}),e.jsx("div",{className:"w-full overflow-auto",children:e.jsxs("table",{className:"w-full text-sm table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-600",children:[e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3",children:"Description"}),e.jsx("th",{className:"p-3",children:"System"}),e.jsx("th",{className:"p-3",children:"Active"}),e.jsx("th",{className:"p-3",children:"Actions"})]})}),e.jsxs("tbody",{children:[f&&f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-3 text-slate-500",children:"No roles found."})}),f&&f.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 align-top font-medium text-slate-800",children:s.RoleName}),e.jsx("td",{className:"p-3 align-top text-slate-600",children:s.RoleDescription||"-"}),e.jsx("td",{className:"p-3 align-top",children:s.IsSystemRole?e.jsx("span",{className:"text-red-600",children:"Yes"}):e.jsx("span",{className:"text-green-600",children:"No"})}),e.jsx("td",{className:"p-3 align-top",children:s.IsActive?e.jsx("span",{className:"text-green-600",children:"Yes"}):e.jsx("span",{className:"text-red-600",children:"No"})}),e.jsx("td",{className:"p-3 align-top",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(s),className:"p-2 rounded-md hover:bg-gray-100",title:"Edit",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>B(s),className:"p-2 rounded-md hover:bg-red-50 text-red-600",title:"Delete",children:e.jsx(L,{className:"h-4 w-4"})})]})})]},s.RoleID))]})]})})]})]}),e.jsx(U,{open:o.open,onClose:()=>c({open:!1,id:null,form:null}),title:o.form?`Edit: ${o.form.RoleName}`:"Edit Role",children:o.form&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Role Name"}),e.jsx("input",{value:o.form.RoleName,onChange:s=>c(t=>({...t,form:{...t.form,RoleName:s.target.value}})),className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-left text-sm font-medium text-slate-700 block mb-1",children:"Description"}),e.jsx("textarea",{value:o.form.RoleDescription,onChange:s=>c(t=>({...t,form:{...t.form,RoleDescription:s.target.value}})),rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-md text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!o.form.IsSystemRole,onChange:s=>c(t=>({...t,form:{...t.form,IsSystemRole:s.target.checked}})),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"System Role"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:!!o.form.IsActive,onChange:s=>c(t=>({...t,form:{...t.form,IsActive:s.target.checked}})),className:"form-checkbox h-4 w-4"}),e.jsx("span",{children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>c({open:!1,id:null,form:null}),className:"px-4 py-2 rounded border",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:o.saving,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:o.saving?"Saving...":"Update"})]})]})}),e.jsx(q,{open:x.open,title:x.title,message:x.message,onCancel:()=>g({open:!1,id:null,title:"",message:"",processing:!1}),onConfirm:F,confirmLabel:"Yes",cancelLabel:"No",loading:x.processing})]})}export{W as default};
